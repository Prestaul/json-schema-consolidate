#!/usr/bin/env bash

validator=$1

VALIDATORS=( "is-my-json-valid" "jjv" "tv4" )

function mocha_tests()
{
    export JSC_VALIDATOR=$1
    ./node_modules/.bin/mocha --reporter=spec spec/*.spec.js
    export JSC_VALIDATOR=""
}

if [[ $validator == "" || $validator == "--full" ]]; then
    mocha_tests
    for val in "${VALIDATORS[@]}"; do
        results=$(json-schema-tests "spec/adapter/$val.js")
        if [[ $validator == "--full" ]]; then
            echo $'\n\n'"Testing ${val}"$'\n'
            echo "$results"
        else
            echo "${val}: $(echo "$results" | grep -i 'passed')"
        fi
    done
else
    mocha_tests $validator
    json-schema-tests "spec/adapter/$validator.js"
fi
